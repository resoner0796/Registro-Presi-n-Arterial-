<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro de Presión Arterial</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f5faff;
      color: #333;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .app {
      width: 100%;
      max-width: 480px;
      height: 100vh;
      display: flex;
      flex-direction: column;
      background: #fff;
    }

    header {
      padding: 15px;
      text-align: center;
      font-size: 1.4em;
      font-weight: bold;
      background: #e6f0fa;
      border-bottom: 2px solid #d0e0f0;
    }

    .screen {
      flex: 1;
      display: none;
      flex-direction: column;
      padding: 15px;
      overflow: hidden;
    }
    .screen.active {
      display: flex;
    }

    /* Pantalla inicio */
    .patient-list {
      flex: 1;
      overflow-y: auto;
      margin-top: 10px;
    }
    .patient-card {
      padding: 12px;
      background: #f0f8ff;
      margin: 8px 0;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .patient-card:hover {
      background: #dceeff;
    }

    /* Panel superior */
    .last-reading {
      display: flex;
      justify-content: space-around;
      background: #eef7ff;
      border-radius: 10px;
      padding: 15px 10px;
      margin-bottom: 10px;
    }
    .last-reading div {
      font-size: 2em;
      font-weight: bold;
      color: #004080;
    }
    .patient-name {
      text-align: center;
      font-size: 0.9em;
      color: #444;
      margin-bottom: 15px;
      word-break: break-word;
    }

    /* Inputs */
    input {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1em;
    }
    button {
      width: 100%;
      padding: 12px;
      background: #0077cc;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1em;
      margin-top: 8px;
    }
    button:hover {
      background: #005fa3;
    }

    /* Estado */
    .status {
      margin-top: 12px;
      font-weight: bold;
      text-align: center;
      font-size: 1.1em;
    }

    /* Sugerencias desplegable */
    details {
      margin-top: 10px;
      background: #f0f8ff;
      border-radius: 6px;
      padding: 10px;
    }
    details summary {
      font-weight: bold;
      cursor: pointer;
    }

    /* Historial */
    .history {
      margin-top: 10px;
      flex: 1;
      overflow-y: auto;
    }
    .history-entry {
      background: #f9f9f9;
      padding: 8px;
      margin-bottom: 6px;
      border-radius: 6px;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>Registro de Presión Arterial</header>

    <!-- Pantalla inicio -->
    <div id="homeScreen" class="screen active">
      <h3>Pacientes</h3>
      <div class="patient-list" id="patientList"></div>
      <input type="text" id="newPatientName" placeholder="Nombre del paciente">
      <button onclick="addPatient()">Agregar Paciente</button>
    </div>

    <!-- Pantalla paciente -->
    <div id="patientScreen" class="screen">
      <div class="last-reading" id="lastReading">
        <div>--</div>
        <div>--</div>
        <div>--</div>
      </div>
      <div class="patient-name" id="patientName"></div>

      <input type="number" id="sys" placeholder="Sistólica (mmHg)">
      <input type="number" id="dia" placeholder="Diastólica (mmHg)">
      <input type="number" id="hr" placeholder="Pulso (lpm)">
      <button onclick="addReading()">Registrar Toma</button>

      <div class="status" id="status"></div>
      <details id="suggestionsBlock" style="display:none;">
        <summary>Ver sugerencias</summary>
        <div id="suggestions"></div>
      </details>

      <h4>Historial</h4>
      <div class="history" id="history"></div>
      <button onclick="backHome()">Regresar</button>
    </div>
  </div>

  <script>
    let patients = JSON.parse(localStorage.getItem("patients")) || [];
    let currentPatientIndex = null;

    function saveData() {
      localStorage.setItem("patients", JSON.stringify(patients));
    }

    function renderPatients() {
      const list = document.getElementById("patientList");
      list.innerHTML = "";
      patients.forEach((p, i) => {
        const div = document.createElement("div");
        div.className = "patient-card";
        div.innerText = p.name;
        div.onclick = () => openPatient(i);
        list.appendChild(div);
      });
    }

    function addPatient() {
      const name = document.getElementById("newPatientName").value.trim();
      if (!name) return;
      patients.push({ name, readings: [] });
      saveData();
      renderPatients();
      document.getElementById("newPatientName").value = "";
    }

    function openPatient(index) {
      currentPatientIndex = index;
      document.getElementById("homeScreen").classList.remove("active");
      document.getElementById("patientScreen").classList.add("active");
      document.getElementById("patientName").innerText = patients[index].name;
      renderHistory();
    }

    function backHome() {
      document.getElementById("patientScreen").classList.remove("active");
      document.getElementById("homeScreen").classList.add("active");
      currentPatientIndex = null;
    }

    function addReading() {
      const sys = parseInt(document.getElementById("sys").value);
      const dia = parseInt(document.getElementById("dia").value);
      const hr = parseInt(document.getElementById("hr").value);
      if (!sys || !dia || !hr) return;

      const reading = { sys, dia, hr, date: new Date().toLocaleString() };
      patients[currentPatientIndex].readings.unshift(reading);
      saveData();
      document.getElementById("sys").value = "";
      document.getElementById("dia").value = "";
      document.getElementById("hr").value = "";
      renderHistory();
    }

    function renderHistory() {
      const historyDiv = document.getElementById("history");
      const readings = patients[currentPatientIndex].readings;
      historyDiv.innerHTML = "";
      readings.forEach(r => {
        const div = document.createElement("div");
        div.className = "history-entry";
        div.innerText = `${r.date} → ${r.sys}/${r.dia} mmHg, Pulso: ${r.hr}`;
        historyDiv.appendChild(div);
      });
      renderLastReading();
    }

    function renderLastReading() {
      const readings = patients[currentPatientIndex].readings;
      const panel = document.getElementById("lastReading").children;
      const statusDiv = document.getElementById("status");
      const suggBlock = document.getElementById("suggestionsBlock");
      const suggDiv = document.getElementById("suggestions");

      if (readings.length === 0) {
        panel[0].innerText = panel[1].innerText = panel[2].innerText = "--";
        statusDiv.innerText = "";
        suggBlock.style.display = "none";
        return;
      }

      const last = readings[0];
      panel[0].innerText = last.sys;
      panel[1].innerText = last.dia;
      panel[2].innerText = last.hr;

      let status = "Normal";
      let suggestions = "Mantén un estilo de vida saludable.";
      if (last.sys < 90 || last.dia < 60) {
        status = "Baja";
        suggestions = "Aumenta la hidratación, evita cambios bruscos de posición y consulta a un médico si persiste.";
      } else if (last.sys > 140 || last.dia > 90) {
        status = "Alta";
        suggestions = "Reduce sal, estrés y consulta a un médico si se repite.";
      }
      statusDiv.innerText = "Presión " + status;
      suggDiv.innerText = suggestions;
      suggBlock.style.display = "block";
    }

    renderPatients();
  </script>
</body>
</html>